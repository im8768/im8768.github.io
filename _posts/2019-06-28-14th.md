안드로이드 패키지매니저

> package installer : 안드로이드에 패키지를 설치하는 기본 App

패키지 인스톨러는 App/Package를 관리하기 위한 사용자 인터페이스를 제공하며 InstallAppProgress Activity를 호출하여 사용자 명령을 전달받는다.

> package manager : app 설치, 삭제, 업그레이드를 위한 API

패키지매니저는 APK파일을 설치할 때 패키지 파일을 분석해 확인창을 보여주고, OK 버튼을 누르면 PackageManager가 4개의 Parameter를 갖는 InstallPackage 메소드를 호출한다.


패키지 매니저는 /data/system 내의 3개 파일에 App 정보를 저장한다.

1. Package.xml : Packages/Application 과 Permission 목록을 갖고 있다.
2. Packages.list : Package Name, User ID, flag, data directory 등의 정보를 갖는 텍스트 파일, description을 찾을 순 없지만 중요정보만을 갖기 때문에 설치된 Package를 빠르게 찾을 수 있다. 
3. packages-stopped.xml : 정지된 상태의 Package 목록을 갖는 파일로 정지된 Application은 Broadcast를 받을 수 없다.



패키지 매니저 관련 소스코드

frameworks/base/services/java/com/android/server/pm/Settings.java
frameworks/base/services/java/com/android/server/pm/PackageManagerService.java
frameworks/base/services/java/com/android/server/pm/IPackageManager.aidl
frameworks/base/services/java/com/android/server/pm/PackageSignatures.java
frameworks/base/services/java/com/android/server/pm/PreferredActivity.java
frameworks/services/java/com/android/server/PreferredComponent.java
frameworks/core/java/android/content/IntentFilter.java
frameworks/base/core/java/android/content/pm/PackageParser.java
frameworks/base/services/java/com/android/server/pm/Installer.java
frameworks/base/core/java/com/android/internal/app/IMediaContainerService.aidl
frameworks/base/packages/DefaultContainerService/src/com/android/defcontainer/DefaultContainerService.java
.
.
.





Packagemanager.java 와 PackageManagerService.java 경로

> android-6.0.1_r81 / . / core / java / android / content / pm / Packagemanaver.java

> android-6.0.1_r81 / . / services / core / java / com / android / server / pm / PackageManagerService.java




Dump 

소스 코드 분석에 앞서 안드로이드 6.0.1 버전에서 스캐닝되는 Package를 먼저 알아보았음


ADB Shell 명령어

```
$$ adb (android debugger)
      # 인식이 잘 안 될 경우 해당 서버를 종료합니다
        $ adb kill-server

        # 연결된 기기들을 봅니다
        $ adb devices

        # 쉘을 띄웁니다
        $ adb -d shell

        # test.apk를 설치합니다
        $ adb -d install test.apk



$$ dumpsys
       # 현재 시스템의 정보를 전부 확인합니다 
        $ dumpsys

        # cpu 관련 정보만 확인합니다
        $ dumpsys cpuinfo

        # wifi 정보를 확인합니다
        $ dumpsys wifi

        # 메모리 관련 정보만 확인합니다
        $ dumpsys meminfo


$$ pm (package manager)
       # 설치된 앱들을 봅니다
        $ pm list package -f

        # 사용자의 이름을 확인합니다
        $ pm list users

        # 모든 시스템 패키지들의 권한을 확인합니다
        $ pm list permissions -d -g 

        # 특정 앱을 삭제합니다
        $ pm uninstall com.example.MyApp

```
